<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>desktop</title>
        <link rel="stylesheet" href="/pages/index.css" />
    </head>
    <script type="module" src="../custom-elements/define.mjs"></script>
    <script type="module">
        import { initTheme } from "/utils/theme.js";
        import { FileStorage } from "/utils/fileStorage.js";
        import { createPictureShortcut } from "/utils/createFromFileStorage.js";

        initTheme();
        FileStorage.init();

        // init shortcuts
        for (const [id, info] of FileStorage.getPictures()) {
            createPictureShortcut(info);
        }
    </script>
    <script src="https://unpkg.com/@ungap/custom-elements-builtin"></script>
    <script type="module" src="https://unpkg.com/x-frame-bypass"></script>

    <body>
        <main>
            <img id="os-logo" src="/media/os-logo.png" alt="os-logo"/>
            <div id="preview-bg"></div>
            <section id="shortcuts">
                <desktop-shortcut
                    wc-tag-name="js-coder"
                    name="JSCoder"
                    icon-src="../media/editor-icon.svg"
                ></desktop-shortcut>
                <desktop-shortcut
                    wc-tag-name="web-browser"
                    name="Browser"
                    icon-src="../media/browser-icon.png"
                ></desktop-shortcut>
                <desktop-shortcut
                    wc-tag-name="web-calculator"
                    name="Calcs"
                    icon-src="../media/calcs-icon.png"
                ></desktop-shortcut>
                <desktop-shortcut
                    wc-tag-name="web-recorder"
                    name="Recorder"
                    icon-src="../media/recorder-icon.png"
                ></desktop-shortcut>
            </section>
            <section id="windows"></section>    

            <ul
                id="context-menu"
                tabindex="0"
                onblur="(event) => console.log(event)"
            >
                <li><button>Edit mode</button></li>
            </ul>

            <desktop-clock></desktop-clock>
        </main>
        <desktop-taskbar></desktop-taskbar>
    </body>

    <script>
        var main = document.querySelector("main");
        var menu = document.querySelector("#context-menu");
        menu.style.display = "none";

        window.addEventListener("contextmenu", (event) => {
            if (event.target !== main) return;
            event.preventDefault();

            menu.focus();
            menu.style.display = "unset";
            menu.style.left = event.x;
            menu.style.top = event.y;
        });

        menu.onblur = (event) => {
            menu.style.display = "none";
        };

        //var windowsContainer = document.querySelector("#windows");
    </script>
</html>
